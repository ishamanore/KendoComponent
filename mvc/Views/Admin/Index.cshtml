<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://kendo.cdn.telerik.com/2023.1.117/styles/kendo.common.min.css" rel="stylesheet" />
    <link href="https://kendo.cdn.telerik.com/2023.1.117/styles/kendo.default.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2023.1.117/js/kendo.all.min.js"></script>
    <script src="https://unpkg.com/jszip/dist/jszip.min.js"></script>
    <script src="https://unpkg.com/pako/dist/pako_deflate.min.js"></script>

    <title>Document</title>

    <script>
        $(document).ready(function () {
            var dataSource = new kendo.data.DataSource({
                transport: {
                    read: {
                        url: "/Admin/GetAllTrip/",
                        dataType: "json",
                    },
                },
                pageSize: 5,
                schema: {
                    model: {
                        id: "c_id",
                        fields: {
                            c_id: { type: "number" },
                            c_triptype: { type: "string" },
                            c_tripname: { type: "string" },
                            c_date: { type: "string" },
                            c_time: { type: "string" },
                            c_days: { type: "number" },
                            c_image: { type: "string" },
                            c_price: { type: "string" },
                            c_availableseat: { type: "number" },
                            c_initialseat: { type: "number" },
                            c_description: { type: "string" },
                        }
                    }
                }
            });

            $("#admingrid").kendoGrid({
                dataSource: dataSource,
                columns: [
                    { field: "c_id", title: "Id", hidden: true },
                    { field: "c_triptype", title: "Type", width: 120 },
                    { field: "c_tripname", title: "Name", width: 120 },
                    { field: "c_date", title: "Date" },
                    { field: "c_time", title: "Time" },
                    { field: "c_days", title: "Days" },
                    { field: "c_image", title: "Image", template: '<img src="#= c_image #" alt="#= c_image #" style= "border-radius:20%; width:30px; height:30px"></img>' },
                    { field: "c_price", title: "Price" },
                    { field: "c_availableseat", title: "Available seat" },
                    { field: "c_initialseat", title: "Initial seat" },
                    { field: "c_description", title: "Description" },
                ],
                editable: "popup",
                pageable: true,
                sortable: true,
                filterable: true,
                resizeable: true,
                toolbar: [{ template: "<button id='addtripbtn'>Add Trip</button>" }, "search", "excel"],
                search: { fields: ["c_triptype", "c_tripname", "c_date", "c_time", "c_days", "c_price", "c_availableseat", "c_initialseat", "c_description"] },
                excel: { fileName: "alltrip.xlsx" },
            });
            
            @* for add trip *@
            $("#addtrip").kendoWindow({
                animation: false,
                width: '600px',
                height: '480px',
                visible: false,
                draggable: false,
                resizable: false,
                title: "Event Detail",
                actions: [
                    "Close"
                ],
                modal: true,
            }).data("kendoWindow");

            function AddTrip() {
                $("#addtrip").data("kendoWindow").center().open();
            };

            $("#addtripbtn").kendoButton({
                themeColor:"secondary",
            }).click(AddTrip);
        });

        @* function for edit/add trip *@
        function EditStudent(){
            var id = $("#c_id").val();
            var trip={
                c_triptype:$("input[name='c_triptype']:checked").val();
                c_tripid:parseInt($("#c_tripid").val());
                c_date:$("#c_date").val();
                c_time:$("#c_time").val();
                c_days:$("#c_days").val();
                c_image:$("#c_image").val();
                c_price:$("#c_price").val();
                c_availableseat:$("#c_availableseat").val();
                c_initialseat:$("#c_initialseat").val();
                c_description:$("#c_description").val();
            };

            if(!id){
                $.ajax({
                    url:"/Admin/AddTrip/",
                    type:"POST",
                    data:trip,
                    success:function(response){
                        window.location.reload();                   
                    },
                    error: function (error) {
                            console.log("error while adding data: " + error);
                    }

                });
            }
            else{
                $.ajax({
                    url:"/Admin/UpdateTrip/",
                    type:"POST",
                    data:trip,
                    success:function(response){
                        window.location.reload();                   
                    },
                    error: function (error) {
                            console.log("error while adding data: " + error);
                    }
                });
            }
        }
    </script>
    


    @* for kendo *@
    <script>
        $(document).ready(function () {
            $("#c_tripid").kendoDropDownList({
                optionLabel: "--select--",
                dataValueField: "c_tripid",
                dataTextField: "c_tripname",
                dataSource: {
                    transport: {
                        read: {
                            url: "/Admin/FetchTripName/",
                            dataType: "json",
                        }
                    }
                }
            });
            $("#c_date").kendoDatePicker();
            $("#c_time").kendoTimePicker();
            $("#c_days").kendoTextBox();
            $("#c_price").kendoTextBox();
            $("#c_availableseat").kendoTextBox();
            $("#c_initialseat").kendoTextBox();
            $("#c_description").kendoTextArea({
                rows: 3
            });
            $("#c_image").kendoUpload();
            $("#update").kendoButton({
                themeColor: "secondary",
            });
            $("#closebtn").kendoButton({
                themeColor: "error",
            });
        });
    </script>

</head>

<body>
    <div id="admingrid"></div>

    <div id="addtrip">
        <div>
            <div class="form-group">
                <input type="hidden" class="form-control k-textbox" id="c_id" name="c_id">
            </div>
            <div class="form-group">
                <label for="c_triptype">Trip type:</label>
                <input type="radio" class="form-control k-radio" name="c_triptype" id="c_triptype"
                    value="international">&nbsp; International &nbsp;&nbsp;
                <input type="radio" class="form-control k-radio" name="c_triptype" id="c_triptype"
                    value="domestic">&nbsp; Domestic
                <span style="font-size:small" id="errorname"></span>
            </div>
            <div class="form-group">
                <label for="c_tripid">Trip name:</label>
                <select name="c_tripid" id="c_tripid" class="form-control">
                    <option value="">--select trip--</option>
                </select>
                <span style="font-size:small" id="errorage"></span>
            </div>
            <div class="form-group">
                <label for="c_date">Select date:</label>
                <input type="date" id="c_date" name="c_date" class="form-control k-date">
                <span style="font-size:small" id="errorgender"></span>
            </div>
            <div class="form-group">
                <label for="c_time">Trip time:</label>
                <input type="time" id="c_time" style="width: 50%" class="form-control" name="c_time">
                <span style="font-size:small" id="errordob"></span>
            </div>
            <div class="form-group">
                <label for="c_days">In how many days trip will arrive:</label>
                <input type="number" id="c_days" name="c_days" class="form-control">
                <span style="font-size:small" id="errordept"></span>
            </div>
            <div class="form-group">
                <label for="c_image">Upload image:</label>
                <input type="file" id="c_image" name="c_image" class="form-control">
                <span style="font-size:small" id="errorinterest"></span>
            </div>
            <div class="form-group">
                <label for="c_price">Trip price:</label>
                <input type="number" id="c_price" name="c_price" class="form-control">
                <span style="font-size:small" id="errordept"></span>
            </div>
            <div class="form-group">
                <label for="c_availableseat">Available seat:</label>
                <input type="number" id="c_availableseat" name="c_availableseat" class="form-control">
                <span style="font-size:small" id="errordept"></span>
            </div>
            <div class="form-group">
                <label for="c_days">Initial seat:</label>
                <input type="number" id="c_initialseat" name="c_initialseat" class="form-control">
                <span style="font-size:small" id="errordept"></span>
            </div>
            <div class="form-group">
                <label for="c_description">Trip description:</label>
                <textarea type="text" id="c_description" placeholder="about trip" name="c_description"
                    class="form-control" rows="3"></textarea>
                <span style="font-size:small" id="errordept"></span>
            </div>
        </div><br>
        <div>
            <button class="btn btn-primary" onclick="EditStudent()" id="update">Add trip</button>
            <button class="btn btn-trans" onclick="closepopup()" id="closebtn">Close</button>
        </div>
    </div>
</body>

</html>